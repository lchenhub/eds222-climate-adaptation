---
title: "Climate Adaptation and Income"
format: html
editor: visual
---

```{r}
knitr::opts_chunk$set(echo = TRUE)

# Load all the packages needed here
library(tidyverse)
library(readr)
library(gt)
library(tufte)
library(sf)
library(feasts)
library(dplyr)
library(janitor)

# Set the filepath here
rootdir <- ("/Users/lianechen/Documents/MEDS_2023/Fall_2023/EDS222/Final/eds222-climateadapt")

datadir <- file.path(rootdir,"data")
```

```{r}
# Import data
city_indicators <- read.csv("data/City Indicators.csv")
readiness <- read.csv("data/Overall Risk & Readiness Scores.csv")
```

```{r}
# Clean column names for both datasets
city_indicators <- clean_names(city_indicators)
readiness <- clean_names(readiness)
```

```{r}
# Explore data
nrow(city_indicators)
```

```{r}
nrow(readiness)
```

```{r}
merged <- merge(city_indicators, readiness, by = "city", all = TRUE)

nrow(merged)
```

```{r}
colnames(merged)[colnames(merged) == "geo_id.x"] <- "geo_id"
colnames(merged)[colnames(merged) == "state.x"] <- "state"
colnames(merged)[colnames(merged) == "latitutde"] <- "latitude"
```

```{r}
income_readiness <- merged[, c("city", "state", "geo_id", "percent_of_population_spending_over_50_percent_of_income_on_rent_2015", "percent_of_population_in_poverty_2015", "latitude", "longitude", "county", "region", "median_income", "overall_readiness")]
```

```{r}
#create scatterplot to understand information

ggplot(data=income_readiness, aes(x=percent_of_population_in_poverty_2015, y = overall_readiness)) + 
  geom_point(size=3) + 
  theme_bw() + 
  labs(title = "Scatterplot of % in Poverty vs Overall Readiness for Climate Adapatation",
       x = "Percent of population in poverty (2015)", y = "Overall readiness")
```

```{r}
# Compute the correlation coefficient to quantify the strength and direction of the relationship

cor(income_readiness$percent_of_population_in_poverty_2015, income_readiness$overall_readiness)
```

```         
Magnitude of the Correlation Coefficient:

The correlation coefficient ranges from -1 to 1.
A value of -1 indicates a perfect negative correlation, 0 indicates no correlation, and 1 indicates a perfect positive correlation.
In this case, the value is close to 0, which suggests a weak correlation.
Sign of the Correlation Coefficient:

The negative sign indicates a negative correlation.
A negative correlation means that as one variable (percentage in poverty) increases, the other variable (overall adaptation readiness) tends to decrease.
Interpretation:

With a correlation coefficient of -0.1565957, there is a slight tendency that areas with a higher percentage of people in poverty may have lower overall adaptation readiness.
However, the correlation is weak, suggesting that other factors not considered in this analysis may play a more significant role in determining overall adaptation readiness.
Caution:

Correlation does not imply causation. Even though there is a correlation, it doesn't necessarily mean that poverty causes lower adaptation readiness or vice versa. Other factors might contribute to the observed relationship.
Further Analysis:

Consider exploring additional variables or conducting regression analysis to better understand the specific nature and strength of the relationship, while controlling for potential confounding variables.
Assess the statistical significance of the correlation coefficient to determine whether the observed relationship is likely due to chance.
In summary, the negative correlation coefficient suggests a weak tendency for areas with a higher percentage of people in poverty to have lower overall adaptation readiness. However, the strength of this relationship is not strong, and it's important to interpret such correlations cautiously, considering other factors that might influence the observed pattern.
```

```{r}
# Linear regression model
linear_regression <- lm(overall_readiness ~ percent_of_population_in_poverty_2015, data = income_readiness)

# Summary of the model
summary(linear_regression)
```

```         
Intercept (0.5098146):

The intercept represents the estimated value of the dependent variable when all independent variables are zero.
In this context, when the percentage of the population in poverty is zero, the estimated value of the overall adaptation readiness is approximately 0.5098.

Percentage of Population in Poverty Coefficient (-0.0023953):

The coefficient for the variable "percent_of_population_in_poverty_2015" represents the estimated change in the dependent variable (overall adaptation readiness) for a one-unit change in the independent variable (percentage of population in poverty).
In this case, for every one-unit increase in the percentage of the population in poverty, the overall adaptation readiness is estimated to decrease by approximately 0.0024.
The t-value of -2.634 indicates that this coefficient is statistically significant (p = 0.00891), suggesting that the percentage of the population in poverty has a significant effect on overall adaptation readiness.

In summary, the model suggests that both the intercept and the percentage of the population in poverty are statistically significant in predicting overall adaptation readiness. 
```

```{r}
ggplot(data=linear_regression, aes(x=percent_of_population_in_poverty_2015, y = overall_readiness)) + 
  geom_point(alpha=0.1, linewidth=3) + 
  geom_smooth(method='lm', formula= y~x, color="lightcoral", se=F, size=1.5) +
  theme_bw() +
  labs(title = "Regression line overlaid on scatter plot",
       x = "Percent of population in poverty (2015)", y = "Overall readiness")
```


```{r}
# Hypothesis testing
summary(linear_regression)$coefficients
```
